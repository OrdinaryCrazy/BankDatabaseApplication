# **“银行业务管理系统”**——系统设计报告

>   小组成员：
>
>   王浩宇（PB16110428）
>
>   吴雨菲（PB15020693）
>
>   张劲暾（PB16111485）
>
>   AT:
>
>   **中国科学技术大学**
>
>   **计算机科学与技术学院**
>
>   **2019年6月**

## 目录

---

[TOC]

---

## 1. 概述

### 1.1 系统目标



### 1.2 需求说明



### 1.3 本报告的主要贡献



## 2. 总体设计

### 2.1 系统模块结构

```shell
bankManage\                     # web工程前后端项目文件夹
    |
    | - backEndService\         # FLASK后端项目文件夹
    |       |
    |       | - __pycache__\    # FLASK后端-Python字节码文件夹
    |       | - account.py      # FLASK后端-账户管理模块
    |       | - bank.py         # FLASK后端-支行管理模块
    |       | - customer.py     # FLASK后端-客户管理模块
    |       | - loan.py         # FLASK后端-贷款管理模块
    |       | - login.py        # FLASK后端-登录与全局路由模块
    |       | - register.py     # FLASK后端-注册模块
    |       | - staff.py        # FLASK后端-员工管理模块
    |       | - summary.py      # FLASK后端-业务统计模块
    |       | - test.py         # FLASK后端-独立于数据库的调试模块
    | - build\					# VUE webpacket 项目构建文件夹
    | - config\                 # VUE webpacket 项目配置文件夹
    | - node_modules\           # VUE webpacket 项目模型组件文件夹
    | - src\                    # VUE webpacket 项目前端源代码文件夹
    |       |
    |       | - assets
    |       | - components
    |       | - router\
    |       |       |
    |       |       | - index.js       # 全局路由
    |       | - views\
    |       |       |
    |       |       | - account.vue    # VUE前端-账户管理模块
    |       |       | - bank.vue       # VUE前端-支行管理模块
    |       |       | - customer.vue   # VUE前端-客户管理模块
    |       |       | - error.vue      # VUE前端-错误处理模块
    |       |       | - index.vue      # VUE前端-主页模块
    |       |       | - loan.vue       # VUE前端-贷款管理模块
    |       |       | - login.vue      # VUE前端-登录模块
    |       |       | - register.vue   # VUE前端-注册模块
    |       |       | - staff.vue      # VUE前端-员工管理模块
    |       |       | - summary.vue    # VUE前端-业务统计模块
    |       | - App.vue  
    |       | - main.js
    | - static\					# VUE webpacket 项目静态文件文件夹，版本控制与背景图片
    | - test\                   # VUE webpacket 项目系统测试文件夹
    | - .babelrc
    | - .editorconfig
    | - .eslintignore
    | - .eslintrc.js
    | - .gitignore
    | - .postcssrc.js
    | - index.html
    | - package-lock.json
    | - package.json
    | - README.md
sql\
    |
    | - bank.sql                    #
    | - build.sql                   #
    | - change_customer_name.sql    #
    | - change_employee_name.sql    #
    | - change_sub_bank_name.sql    #
    | - test_data.sql               #
```

### 2.2 系统工作流程



### 2.3 数据库设计

#### 2.3.1 支行表

存储所有支行账户信息

| 属性       | 说明                         |
| ---------- | ---------------------------- |
| BANK_NAME  | 主键，支行名称               |
| CITY       | 支行所在城市                 |
| POSSESSION | 支行资产，默认值为0          |
| BANK_PASS  | 支行账户密码，默认值为123456 |

```sql
/* 支行表 */
CREATE TABLE SUB_BANK (
    BANK_NAME   CHAR(50)    CONSTRAINT BAMK_PK PRIMARY KEY,
    CITY        CHAR(50),
    POSSESSION  FLOAT       DEFAULT 0.0,
------------------------------------------------
    BANK_PASS   CHAR(6)     DEFAULT '123456'
);
```

#### 2.3.2 员工表

#### 2.3.3 客户表

#### 2.3.4 支票账户表

## 3. 详细设计

### 3.1 运行环境配置概述

### 3.2 VUE前端

#### 3.2.1 VUE全局路由

##### 3.2.1.1 设计思路

##### 3.2.1.2 输入

##### 3.2.1.3 输出

##### 3.2.1.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.2 VUE账户管理模块

##### 3.2.2.1 设计思路

##### 3.2.2.2 输入

##### 3.2.2.3 输出

##### 3.2.2.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.3 VUE支行管理模块

##### 3.2.3.1 设计思路

##### 3.2.3.2 输入

##### 3.2.3.3 输出

##### 3.2.3.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.4 VUE客户管理模块

##### 3.2.4.1 设计思路

##### 3.2.4.2 输入

##### 3.2.4.3 输出

##### 3.2.4.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.5 VUE错误处理模块

##### 3.2.5.1 设计思路

##### 3.2.5.2 输入

##### 3.2.5.3 输出

##### 3.2.5.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.6 VUE主页模块

##### 3.2.6.1 设计思路

##### 3.2.6.2 输入

##### 3.2.6.3 输出

##### 3.2.6.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.7 VUE贷款管理模块

##### 3.2.7.1 设计思路

##### 3.2.7.2 输入

##### 3.2.7.3 输出

##### 3.2.7.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.8 VUE登录模块

##### 3.2.8.1 设计思路

##### 3.2.8.2 输入

##### 3.2.8.3 输出

##### 3.2.8.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.9 VUE注册模块

##### 3.2.9.1 设计思路

##### 3.2.9.2 输入

##### 3.2.9.3 输出

##### 3.2.9.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.10 VUE员工管理模块

##### 3.2.10.1 设计思路

##### 3.2.10.2 输入

##### 3.2.10.3 输出

##### 3.2.10.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.2.11 VUE业务统计模块

##### 3.2.11.1 设计思路

##### 3.2.11.2 输入

##### 3.2.11.3 输出

##### 3.2.11.4 核心代码概述

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

### 3.3 FLASK后端

#### 3.3.1 FLASK登录与全局路由模块

##### 3.3.1.1 设计思路

##### 3.3.1.2 输入

##### 3.3.1.3 输出

##### 3.3.1.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.3.2 FLASK账户管理模块

##### 3.3.2.1 设计思路

##### 3.3.2.2 输入

##### 3.3.2.3 输出

##### 3.3.2.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.3.3 FLASK支行管理模块

##### 3.3.3.1 设计思路

##### 3.3.3.2 输入

##### 3.3.3.3 输出

##### 3.3.3.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.3.4 FLASK客户管理模块

##### 3.3.4.1 设计思路

STEP 1: 判断前端请求的服务类型

STEP 2: 

+   搜索服务：
    +   获取搜索的用户姓名、用户身份证号、用户电话、用户地址、联系人姓名、联系人电话、联系人电子邮件信息
    +   构建 SELECT SQL 命令字符串
    +   调用数据库接口执行 SELECT SQL 命令，搜索符合条件的条目
    +   获取操作结果
+   修改、新增服务：
    +   获取新的用户姓名、用户身份证号、用户电话、用户地址、联系人姓名、联系人电话、联系人电子邮件信息，联系人和用户关系，旧的用户身份证号
    +   判断是修改还是新增操作
    +   修改操作：
        +   判断是否修改主键，如果修改了，调用存储过程完成对主键的修改
        +   构建 UPDATE SQL 命令字符串
        +   调用数据库接口执行 UPDATE SQL 命令，修改其他属性值
    +   新增操作：
        +   构建 INSERT SQL 命令字符串
        +   调用数据库接口执行 INSERT SQL 命令，增加新的条目
+   删除服务：
    +   获取需要删除的的用户身份证号
    +   构建并调用数据库接口执行 SELECT SQL 命令，判断用户是否还有关联的员工、支票账户、储蓄账户和贷款，如果有，则不能删除用户
    +   如果没有，构建并调用数据库接口执行 DELETE SQL 命令，删除对应的用户

STEP 3: 打包结果信息发送给前端

##### 3.3.4.2 输入

`type`: 前端请求的服务类型

+   搜索服务：
    +   `nameSearch`: 要搜索的用户姓名
    +   `idSearch`: 要搜索的用户身份证号
    +   `telSearch`: 要搜索的用户电话
    +   `addrSearch`: 要搜索的用户地址
    +   `linknameSearch`: 要搜索的联系人姓名
    +   `linktelSearch`: 要搜索的联系人电话
    +   `emailSearch`: 要搜索的联系人电子邮件信息
+   修改、新增服务：
    +   `id_s`: 要修改、新增的用户身份证号
    +   `name`: 要修改、新增的用户姓名
    +   `tel`: 要修改、新增的用户电话
    +   `addr`: 要修改、新增的用户地址
    +   `name_link`: 要修改、新增的联系人姓名
    +   `tel_link`: 要修改、新增的联系人电话
    +   `email_link`: 要修改、新增的联系人电子邮件信息
    +   `relation`: 要修改、新增的联系人和用户关系
    +   `old_primary`: 要修改、新增的旧的用户身份证号
+   删除服务：
    +   `primary`: 要删除的用户身份证号

##### 3.3.4.3 输出

+   搜索服务：
    +   200 message + 查询结果列表
+   修改、新增服务：
    +   402 message + "旧身份证号不存在"
    +   401 message + "新身份证号被使用"
    +   400 message + "操作失败"
    +   200 message + "操作成功"
+   删除服务：
    +   200 message + "操作成功"
    +   407 message + "有关联员工信息"
    +   408 message + "有关联存储账户信息"
    +   409 message + "有关联支票账户信息"
    +   410 message + "有关联贷款信息"

##### 3.3.4.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

```python
#================================================================================
# 客户管理 后台功能
@customer_api.route('/customer',methods=['POST'])
def customer():
    rstype=request.form['type']
    if (rstype=="Search"):
        
        connection = cx_Oracle.connect('System/db2019@localhost/ORCL')
        cursor = connection.cursor()

        nameSearch      = request.form['nameSearch']
        ...
        idSearch        = request.form['idSearch']
        ...
        telSearch       = request.form['telSearch']
        ...
        addrSearch      = request.form['addrSearch']
        ...
        linknameSearch  = request.form['linknameSearch']
        ...
        linktelSearch   = request.form['linktelSearch']
        ...
        emailSearch     = request.form['emailSearch']
        ...

        sqlcommand = ""
        sqlcommand = sqlcommand + " SELECT"
        ...

        cursor.execute(sqlcommand)
        # 使读取的 Oracle 数据字典化
        cursor.rowfactory = makeDictFactory(cursor)
        result = cursor.fetchall()

        response = make_response(...)
        ...
        return response

    if (rstype=="Update"):
       	
        connection = cx_Oracle.connect('System/db2019@localhost/ORCL')
        cursor = connection.cursor()
        id_s        = request.form['id']
        name        = request.form['name']
        ...
        tel         = request.form['tel']
        ...
        addr        = request.form['addr']
        ...
        name_link   = request.form['name_link']
        ...
        tel_link    = request.form['tel_link']
        ...
        email_link  = request.form['email_link']
        ...
        relation    = request.form['relation']
        ...
        old_primary = request.form['old_primary']
        ...

        sqlcommand = ""
        if len(old_primary) > 0 : # 改 #
            if id_s != old_primary :
                result = cursor.var(cx_Oracle.NUMBER)
                cursor.callproc('CHANGE_CUSTOMER_NAME',[old_primary, id_s, result ])
                
                if result.getvalue() == 2 :
                    cursor.close()
                    connection.close()
                    response = make_response(jsonify({    
                                                        'code':402,
                                                        'msg': 'old name do not find'
                                                    })
                                            )
                    ...
                    return response
                if result.getvalue() == 1 :
                    cursor.close()
                    connection.close()
                    response = make_response(jsonify({    
                                                        'code':401,
                                                        'msg': 'new name used'
                                                    })
                                            )
                    ...
                    return response
            
            sqlcommand = sqlcommand + " UPDATE CUSTOMER SET   "
            ...
            sqlcommand = sqlcommand + " WHERE CUSTOMER_ID = '" + id_s + "'"
            
        else : # 增 #
            insert = "("
            insert = insert + "'" + id_s        + "'" + ","
            insert = insert + "'" + name        + "'" + ","
            insert = insert + "'" + tel         + "'" + ","
            insert = insert + "'" + addr        + "'" + ","
            insert = insert + "'" + name_link   + "'" + ","
            insert = insert + "'" + tel_link    + "'" + ","
            insert = insert + "'" + email_link  + "'" + ","
            insert = insert + "'" + relation    + "'" 
            insert = insert + ")"
            sqlcommand =    sqlcommand + "   INSERT ... " + insert
        
        print(sqlcommand)
        try :
            cursor.execute(sqlcommand)
        except :
            cursor.close()
            connection.close()
            response = make_response(jsonify({    
                                            'code':400,
                                            'msg': 'fail'
                                            })
                                    )
            ...
            return response

        cursor.close()
        connection.commit()
        connection.close()
        response = make_response(jsonify({    
                                        'code':200,
                                        'msg': 'ok'
                                        })
                                )
        ...
        return response

    if (rstype=="Delete"):
        
        connection = cx_Oracle.connect('System/db2019@localhost/ORCL')
        cursor = connection.cursor()

        primary = request.form['primary']
        ...
    #==============================================================================
        sqlcommand = " SELECT * FROM EMPLOYEE_CUSTOMER WHERE "
        sqlcommand = sqlcommand + " CUSTOMER_ID = '" + primary + "'"
        print(sqlcommand)
        cursor.execute(sqlcommand)
        # 使读取的 Oracle 数据字典化
        cursor.rowfactory = makeDictFactory(cursor)
        result = cursor.fetchall()
        if len(result) > 0 :
            cursor.close()
            connection.close()
            response = make_response(jsonify({    
                                            'code': 407,
                                            'msg': '有关联员工信息'
                                            })
                                    )
            ...
            return response
    #==============================================================================
        sqlcommand = " SELECT * FROM CUSTOMER_DEPOSIT_ACCOUNT WHERE "
        sqlcommand = sqlcommand + " CUSTOMER_ID = '" + primary + "'"
        print(sqlcommand)
        cursor.execute(sqlcommand)
        # 使读取的 Oracle 数据字典化
        cursor.rowfactory = makeDictFactory(cursor)
        result = cursor.fetchall()
        if len(result) > 0 :
            cursor.close()
            connection.close()
            response = make_response(jsonify({    
                                            'code': 408,
                                            'msg': '有关联存储账户信息'
                                            })
                                    )
            ...
            return response
    #==============================================================================
        sqlcommand = " SELECT * FROM CUSTOMER_CHECK_ACCOUNT WHERE "
        sqlcommand = sqlcommand + " CUSTOMER_ID = '" + primary + "'"
        print(sqlcommand)
        cursor.execute(sqlcommand)
        # 使读取的 Oracle 数据字典化
        cursor.rowfactory = makeDictFactory(cursor)
        result = cursor.fetchall()
        if len(result) > 0 :
            cursor.close()
            connection.close()
            response = make_response(jsonify({    
                                            'code': 409,
                                            'msg': '有关联支票账户信息'
                                            })
                                    )
            ...
            return response
    #==============================================================================
        sqlcommand = " SELECT * FROM LOAN_CUSTOMER WHERE "
        sqlcommand = sqlcommand + " CUSTOMER_ID = '" + primary + "'"
        print(sqlcommand)
        cursor.execute(sqlcommand)
        # 使读取的 Oracle 数据字典化
        cursor.rowfactory = makeDictFactory(cursor)
        result = cursor.fetchall()
        if len(result) > 0 :
            cursor.close()
            connection.close()
            response = make_response(jsonify({    
                                            'code': 410,
                                            'msg': '有关联贷款信息'
                                            })
                                    )
            ...
            return response
    #=============================================================================
        sqlcommand = " DELETE FROM CUSTOMER WHERE "
        sqlcommand = sqlcommand + " CUSTOMER_ID = '" + primary + "'"
        print(sqlcommand)
        cursor.execute(sqlcommand)
        cursor.close()
        connection.commit()
        connection.close()

        response = make_response(jsonify({    
                                        'code':200,
                                        'msg': 'ok'
                                        })
                                )
        ...
        return response
#=================================================================================
```

#### 3.3.5 FLASK贷款管理模块

##### 3.3.5.1 设计思路

##### 3.3.5.2 输入

##### 3.3.5.3 输出

##### 3.3.5.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)


#### 3.3.6 FLASK注册模块

##### 3.3.6.1 设计思路

##### 3.3.6.2 输入

##### 3.3.6.3 输出

##### 3.3.6.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.3.7 FLASK员工管理模块

##### 3.3.7.1 设计思路

##### 3.3.7.2 输入

##### 3.3.7.3 输出

##### 3.3.7.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)

#### 3.3.8 FLASK业务统计模块

##### 3.3.8.1 设计思路

##### 3.3.8.2 输入

##### 3.3.8.3 输出

##### 3.3.8.4 核心代码概

("..." 表示省略的部分，包括出错处理，打包，DEBUG输出等代码)



## 4. 实现与测试

### 4.1 实现结果(界面展示)



### 4.2 测试结果(功能测试)



## 5. 总结与讨论

张劲暾：

>   1.

王浩宇：

>   1.

吴雨菲：

>   1.

## 附录 团队介绍与工作分工

（**本实验使用github管理项目，通过git日志展示开发流程和成员分工**，(用户名已改为学生姓名，无意义的merge条目被删除)）

```shell

```





